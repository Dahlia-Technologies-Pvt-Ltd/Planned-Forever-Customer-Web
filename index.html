<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Planned Forever | Web App</title>
    <script>
      // Set initial direction from localStorage
      const dir = localStorage.getItem("language-direction") || "ltr";
      const lang = localStorage.getItem("i18nextLng") || "en";
      document.documentElement.dir = dir;
      document.documentElement.lang = lang;
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>

    <!-- GLOBAL GOOGLE TRANSLATOR - USED FOR TRANSLATING THE ENTIRE WEBSITE - STARTS HERE -->
    <script>
      // FIX #1: Safely patch insertBefore & removeChild BEFORE Google loads
      (function () {
        const originalInsertBefore = Node.prototype.insertBefore;
        Node.prototype.insertBefore = function (newNode, referenceNode) {
          try {
            if (referenceNode && referenceNode.parentNode !== this) {
              return originalInsertBefore.call(this, newNode, this.lastChild);
            }
            return originalInsertBefore.call(this, newNode, referenceNode);
          } catch (err) {
            console.warn("Google Translate insertBefore prevented:", err);
            return newNode;
          }
        };

        const originalRemoveChild = Node.prototype.removeChild;
        Node.prototype.removeChild = function (child) {
          try {
            if (!this.contains(child)) {
              return child; // ignore
            }
            return originalRemoveChild.call(this, child);
          } catch (err) {
            console.warn("Google Translate removeChild prevented:", err);
            return child;
          }
        };
      })();
    </script>

    <div id="google_translate_element" style="position: absolute; opacity: 0; pointer-events: none; height: 0; width: 0"></div>

    <script type="text/javascript">
      function googleTranslateElementInit() {
        new google.translate.TranslateElement(
          {
            pageLanguage: "en",
            autoDisplay: false,
            // includedLanguages: "en,hi,ta,te,ml,kn,fr,de,es,gu,bn,ur",
            // layout: window.google.translate.TranslateElement.InlineLayout.SIMPLE,
            layout: google.translate.TranslateElement.InlineLayout.HORIZONTAL,
          },
          "google_translate_element",
        );
      }
    </script>

    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    <!-- GLOBAL GOOGLE TRANSLATOR - USED FOR TRANSLATING THE ENTIRE WEBSITE - ENDS HERE -->
  </body>
</html>
